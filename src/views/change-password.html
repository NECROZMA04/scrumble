<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrumble</title>
    <link rel="icon" href="tab-logo.png" type="png">
    <style>
        @import url('https://fonts.cdnfonts.com/css/futura-std-4');
        @import url('https://fonts.cdnfonts.com/css/bukhari-script');

        body {
            font-family: 'Futura', sans-serif; 
            line-height: 1.6;
            background-color: #ffffff;
            color: #6ec6e6;
            padding-left: 5rem;
            padding-right: 5rem;
            padding-top: 1.5rem;
        }

        header {
            font-family: "Bukhari Script", cursive; 
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #6ec6e6;
            padding-bottom: 1rem;
            position: relative;
        }

        nav {
            display: flex;
            gap: 5.0rem;
        }

        nav a {
            font-family: 'Futura', sans-serif;
            color: #6f85a6;
            text-decoration: none;
            font-size: 23px;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #6ec6e6;
        }

        .user-logo {
            width: 50px;
            height: 50px;
            background-image: url('user-icon.png'); 
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            border: none;
            transition: color 0.3s;
        }

        .user-logo:hover {
            color: #6ec6e6;
        }

        hr {
            height: 4px;
            background-color: #6ec6e6;
            border-color: #6ec6e6;
            border: none;
            border-radius: 20px;
        }

        .content {
            padding: 2rem;
            text-align: left; 
        }

        .content label{
            margin-top: 10px;
        }

        form {
            margin-top: 2rem;
        }

        label {
            font-size: 18px;
            color: #6f85a6;
            display: block;
            margin-bottom: 0.5rem;
        }

        .name{
            width: 100%;
            color: black;
            padding: 0.5rem;
            font-size: 56px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }

        .email{
            width: 100%;
            padding: 0.5rem;
            color: #40556e;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }

        .username{
            width: 100%;
            padding: 0.5rem;
            color: #40556e;
            font-size: 20px;
            border: none;
            border-radius: 5px;
            margin-bottom: 1.5rem;
            box-sizing: border-box;
        }

        .button{
            background-color: #6ec6e6;
            color: #ffffff;
            padding: 0.75rem 2rem;
            margin-top: 20px;
            font-size: 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #5ca7c5;
        }

        .bck-button{
            background-color: #cad9df;
            color: #ffffff;
            padding: 0.75rem 2rem;
            margin-top: 20px;
            font-size: 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .bck-button:hover {
            background-color: #a7b1b4;
        }

        
        .logout-button{
            background-color: #66ccff;
            color: #fff;
            font-size: 20px;
            padding: 5px 10px;
            border-radius: 20px;
            display: flex;
            margin-left: 150px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .logout-button:hover{
            background-color: #56a6c4;
        }

        .login-form h2{
            color: #40556e;
            font-size: 40px;
        }
        .login-form {
            width: 100%;
            margin: 0px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
        }

        .login-form input{
            width: 135%;
            padding: 10px 20px;
            margin-top: 10px;
            margin-bottom: 15px;
            border-radius: 20px;
            border: none;
            background-color: #e6e6e6;
            box-sizing: border-box;
            font-family: 'Futura', sans-serif;
            font-size: 11px;
        }

        .login-form label {
            font-family: 'Futura', sans-serif;
            font-size: 16px;
            color: #333;
        }
        
        .generate{
            background-color: #f3af48;
            color: #fff;
            border: none;
            padding: 0.75rem 2rem;
            margin-top: 20px;
            font-size: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s;

        }

        .generate:hover{
            background-color: #d3884a;
        }


    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body onload="checkAuthentication()">
    <header>
        <div class="logo">Scrumble</div>
        <nav>
            <a href="overview.html" class="current">Product Backlog</a>
            <a href="sprint_board.html">Sprint Board</a>
        </nav>
        <div class="logout-button" onclick="logout()">Log out</div>
        <div class="user-logo" onclick="redirectToProfile()"></div>
    </header>
    <hr>
    <div class="content">

        <div class="login-form">
            <h2>Change New Password</h2>
            <form id="password-form">
                <label for="old-password">Old Password:</label>
                <input type="password" id="old-password" name="oldPassword" placeholder="Enter your old password" required>

                <label for="new-password">New Password:</label>
                <input type="text" id="new-password" name="newPassword" placeholder="Enter your new password" required>

                <label for="confirm-password">Confirm New Password:</label>
                <input type="text" id="confirm-password" name="confirmPassword" placeholder="Confirm your new password" required>
            </form>
        </div>
        <button class="generate" type="button" id="generate-password">Generate Password</button>
        <button class="button" type="button" onclick="changePassword()">Confirm</button>
        <button class="bck-button" type="button" onclick="window.history.back()">Back</button>
    </div>

</body>
<script>
    function checkAuthentication() {
        // Retrieve currentMember from localStorage
        const currentMember = JSON.parse(localStorage.getItem('currentMember'));

        // If currentMember does not exist or memberId is -1, redirect to index.html
        if (!currentMember || currentMember.memberId === -1) {
            window.location.href = 'index.html'; // Redirect to login page
        }
    }

    function logout() {
        // Get the currentMember from localStorage
        let currentMember = JSON.parse(localStorage.getItem('currentMember'));

        if (currentMember) {
            // Update the role and memberId
            currentMember.role = 'None';
            currentMember.memberId = -1;

            // Save the updated currentMember back to localStorage
            localStorage.setItem('currentMember', JSON.stringify(currentMember));

            // Redirect to the index.html page (or login page)
            window.location.href = 'index.html';
        } else {
            console.error('No currentMember found in localStorage.');
        }
    }

    function changePassword() {
        // Retrieve form values
        const oldPassword = document.getElementById('old-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        // Get currentMember and users from localStorage
        const currentMember = JSON.parse(localStorage.getItem('currentMember'));
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const memberId = currentMember ? currentMember.memberId : null;

        // Find the user
        const user = users.find(u => u.id === memberId);

        if (user) {
            // Check if the old password matches
            if (user.password === oldPassword) {
                // Check if the new password and confirm password match
                if (newPassword === confirmPassword) {
                    // Update the user's password
                    user.password = newPassword;

                    // Update the users array in localStorage
                    localStorage.setItem('users', JSON.stringify(users));

                    // Alert success and redirect to member profile
                    alert('Password changed successfully!');
                    window.location.href = 'member-profile.html';
                } else {
                    // Alert if new passwords don't match
                    alert('New passwords do not match!');
                }
            } else {
                // Alert if the old password is incorrect
                alert('Old password is incorrect!');
            }
        } else {
            alert('User not found!');
        }
    }

    function redirectToProfile() {
        const currentMember = JSON.parse(localStorage.getItem('currentMember')); // Get the stored currentMember

        if (currentMember && currentMember.role) {
            if (currentMember.role === 'member') {
                window.location.href = 'member-profile.html'; // Redirect to member profile
            } else if (currentMember.role === 'admin') {
                window.location.href = 'Admin_Profile.html'; // Redirect to admin profile
            } else {
                console.error('Invalid role found for the current member.');
            }
        } else {
            console.error('No current member data found.');
        }
    }

    // Function to generate a secure password
    function generatePassword(firstName, lastName) {
        const randomNum = Math.floor(1000 + Math.random() * 9000); // Generate a random 4-digit number
        const randomSpecialChars = "!@#$&";
        const randomChar = randomSpecialChars[Math.floor(Math.random() * randomSpecialChars.length)];
        
        // Combine first and last name with random numbers and a special character
        const password = `${firstName[0]}${firstName[1]}${lastName[0]}${lastName[1]}${randomNum}${randomChar}`;
        
        return password;
    }

    // Event listener for the "Generate Password" button
    document.getElementById('generate-password').addEventListener('click', function () {
        const currentMember = JSON.parse(localStorage.getItem('currentMember'));
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const memberId = currentMember ? currentMember.memberId : null;

        // Find the user
        const user = users.find(u => u.id === memberId);

        if (!currentMember) {
            alert('Please log in first!');
            return;
        }

        // Generate and set the password
        const generatedPassword = generatePassword(user.firstName, user.lastName);
        document.getElementById('new-password').value = generatedPassword;
        document.getElementById('confirm-password').value = generatedPassword;
    });
</script>


</html>
